# Persistent Storage - Testing Guide\n\n## Quick Tests (5-10 minutes)\n\n### Test 1: Progress Persists After Refresh (Logged In)\n\n**Setup:** User is logged in\n\n**Steps:**\n1. Open DevTools: `F12 → Application → Storage → Local Storage`\n2. Note the initial CTF count (if any)\n3. Solve a CTF challenge in the app\n4. Verify localStorage updated: `cybersec_arena_progress_v1` key should show new data\n5. Press `F5` to refresh the page\n6. Verify: The solved challenge is still there\n\n**Expected Result:** ✅ Challenge persists after refresh\n\n**Debug:**\n```javascript\n// In browser console\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf.solvedIds\n// Should show array with your challenge\n```\n\n---\n\n### Test 2: Progress Persists After Logout\n\n**Setup:** User is logged in\n\n**Steps:**\n1. Solve a CTF challenge (note the ID)\n2. Go to Profile → Danger Zone → Logout\n3. You're now logged out but still on the page\n4. Verify localStorage still has the data:\n   ```javascript\n   JSON.parse(localStorage.getItem('cybersec_arena_progress_v1'))\n   // Should show your solved challenge\n   ```\n5. Solve another challenge while logged out\n6. Check localStorage again - should have BOTH challenges\n7. Refresh page\n8. Verify: Both challenges still visible\n\n**Expected Result:** ✅ Progress persists after logout\n\n**Debug:**\n```javascript\n// Count challenges\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf.solvedIds.length\n// Should increase as you solve while logged out\n```\n\n---\n\n### Test 3: Supabase Saves When Logged In\n\n**Setup:** User is logged in, Supabase configured\n\n**Steps:**\n1. Open DevTools Console\n2. Solve a CTF challenge\n3. Watch console - should NOT see error \"Failed to save to Supabase\"\n4. Go to Supabase dashboard → SQL Editor\n5. Run query:\n   ```sql\n   SELECT user_id, ctf_solved_ids FROM user_progress WHERE user_id = '<your-user-id>';\n   ```\n6. Verify: Your solved challenge appears in Supabase\n\n**Expected Result:** ✅ Challenge synced to Supabase database\n\n**Debug:**\n```sql\n-- Get your user ID first\nSELECT id FROM auth.users LIMIT 1;\n-- Then query\nSELECT * FROM user_progress WHERE user_id = '<your-id>';\n```\n\n---\n\n### Test 4: Offline Progress Not Lost\n\n**Setup:** User solved challenges while logged out\n\n**Steps:**\n1. Solve challenges while logged out (verified in localStorage)\n2. Network speed: DevTools → Network → Slow 3G\n3. Login again\n4. Refresh page\n5. Verify: Progress loads from localStorage immediately\n6. Then Supabase loads in background\n\n**Expected Result:** ✅ App works offline, doesn't need network\n\n**Debug:**\n```javascript\n// Check if data is immediately available\n// (shouldn't be loading spinner for long)\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1'))\n```\n\n---\n\n## Comprehensive Tests (15-30 minutes)\n\n### Test 5: Cross-Device Sync\n\n**Setup:** Two browsers/devices, same account\n\n**Device A:**\n1. Login\n2. Solve CTF challenges #1, #2, #3\n3. Verify in Supabase:\n   ```sql\n   SELECT ctf_solved_ids FROM user_progress WHERE user_id = '<your-id>';\n   ```\n4. Logout\n\n**Device B (or Incognito window):**\n1. Login with same account\n2. Verify: All challenges #1, #2, #3 visible\n3. Check localStorage:\n   ```javascript\n   JSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf.solvedIds\n   ```\n   Should show [1, 2, 3]\n\n**Expected Result:** ✅ Progress synced across devices\n\n---\n\n### Test 6: Stress Test - Multiple Rapid Changes\n\n**Setup:** User is logged in\n\n**Steps:**\n1. Solve 5 challenges rapidly (click quickly)\n2. Watch localStorage updates:\n   ```javascript\n   // Keep running this in console to watch\n   JSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf.solvedIds.length\n   ```\n3. Should show 1, 2, 3, 4, 5 as they save\n4. Refresh page\n5. Verify: All 5 persisted\n6. Check Supabase - should have all 5\n\n**Expected Result:** ✅ All changes persisted, no race conditions\n\n---\n\n### Test 7: Badge Persistence\n\n**Setup:** Earn a badge (solve enough challenges)\n\n**Steps:**\n1. Solve enough CTF challenges to unlock a badge\n2. Check localStorage:\n   ```javascript\n   JSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).badges\n   ```\n3. Should show the badge\n4. Refresh page\n5. Verify: Badge still there\n6. Check Supabase:\n   ```sql\n   SELECT badges FROM user_progress WHERE user_id = '<your-id>';\n   ```\n7. Should show the badge\n\n**Expected Result:** ✅ Badges persisted to both storage\n\n---\n\n### Test 8: Reset Functionality Persists\n\n**Setup:** User has solved challenges\n\n**Steps:**\n1. Solve some challenges\n2. Profile → Settings → Reset Progress → Select \"CTF Challenges\"\n3. Confirm reset\n4. Verify: CTF count goes to 0\n5. Check localStorage:\n   ```javascript\n   JSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf.solvedIds\n   ```\n   Should be empty []\n6. Check other sections - should NOT be reset\n7. Refresh page\n8. Verify: Reset persisted (still 0)\n\n**Expected Result:** ✅ Reset state persisted, other sections unaffected\n\n---\n\n## Error Condition Tests\n\n### Test 9: Supabase Connection Lost\n\n**Setup:** User is logged in, Supabase was working\n\n**Steps:**\n1. Disconnect internet (or DevTools → Network → Offline)\n2. Solve a challenge\n3. Check console - should see \"Failed to save to Supabase (but localStorage was saved)\"\n4. Check localStorage - data should be there ✅\n5. Refresh page\n6. Data should load from localStorage ✅\n7. Reconnect internet\n8. Refresh page again\n9. Verify: Now syncs to Supabase\n\n**Expected Result:** ✅ Works offline, syncs when connection restored\n\n---\n\n### Test 10: Browser Storage Disabled (Privacy Mode)\n\n**Setup:** Open browser in Private/Incognito mode\n\n**Steps:**\n1. In private window, try to solve a challenge\n2. Check DevTools → Application → Storage\n3. localStorage section may be empty (browser policy)\n4. Check console for errors\n5. If Supabase configured: Should save to Supabase\n6. Refresh page\n7. Verify: Data loads from Supabase\n\n**Expected Result:** ✅ Works even without localStorage\n\n---\n\n## Debugging Tools\n\n### Browser Console Commands\n\n```javascript\n// Check all progress data\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1'))\n\n// Check just CTF progress\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).ctf\n\n// Check badges\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).badges\n\n// Check quiz difficulty\nJSON.parse(localStorage.getItem('cybersec_arena_progress_v1')).quiz.difficulty\n\n// Clear local storage (for fresh testing)\nlocalStorage.removeItem('cybersec_arena_progress_v1')\n\n// Get storage size\nJSON.stringify(localStorage.getItem('cybersec_arena_progress_v1')).length\n// (bytes)\n\n// Check all localStorage keys\nObject.keys(localStorage)\n```\n\n### DevTools Storage Tab\n\n```\nF12 → Application → Storage → Local Storage\n├─ Select your domain\n├─ Find 'cybersec_arena_progress_v1' key\n├─ Click to see formatted JSON\n└─ Watch updates as you play\n```\n\n### Supabase Queries\n\n```sql\n-- View all user progress\nSELECT * FROM user_progress;\n\n-- View specific user progress\nSELECT * FROM user_progress WHERE user_id = '<your-id>';\n\n-- View just CTF progress\nSELECT user_id, ctf_solved_ids FROM user_progress;\n\n-- View badges\nSELECT user_id, badges FROM user_progress WHERE user_id = '<your-id>';\n\n-- Count total users\nSELECT COUNT(*) FROM user_progress;\n```\n\n### Browser Console Monitoring\n\n```javascript\n// Watch for storage changes (live monitoring)\nsetInterval(() => {\n  const data = JSON.parse(localStorage.getItem('cybersec_arena_progress_v1'));\n  console.clear();\n  console.log('CTF solved:', data.ctf.solvedIds.length);\n  console.log('Badges:', data.badges.length);\n  console.log('Quiz answered:', data.quiz.answered);\n}, 1000);\n```\n\n---\n\n## Test Report Template\n\nUse this to document your testing:\n\n```\nTEST REPORT - Persistent Storage\nDate: ___________\nTester: ___________\nBrowser: ___________\nVersion: ___________\n\n✅ = PASS\n❌ = FAIL\n⚠️ = ISSUE\n\n□ Test 1: Progress Persists After Refresh\n  Result: ___________\n  Notes: ___________\n\n□ Test 2: Progress Persists After Logout\n  Result: ___________\n  Notes: ___________\n\n□ Test 3: Supabase Saves When Logged In\n  Result: ___________\n  Notes: ___________\n\n□ Test 4: Offline Progress Not Lost\n  Result: ___________\n  Notes: ___________\n\n□ Test 5: Cross-Device Sync\n  Result: ___________\n  Notes: ___________\n\n□ Test 6: Stress Test - Multiple Rapid Changes\n  Result: ___________\n  Notes: ___________\n\n□ Test 7: Badge Persistence\n  Result: ___________\n  Notes: ___________\n\n□ Test 8: Reset Functionality Persists\n  Result: ___________\n  Notes: ___________\n\n□ Test 9: Supabase Connection Lost\n  Result: ___________\n  Notes: ___________\n\n□ Test 10: Browser Storage Disabled\n  Result: ___________\n  Notes: ___________\n\nOverall Result: ___________\nIssues Found: ___________\nRecommendations: ___________\n```\n\n---\n\n## Expected Console Output\n\n### Normal Operation (Logged In)\n```\n✓ No errors related to storage\n✓ Only occasional \"Failed to save to Supabase\" if network issues\n✓ Data updates reflected in localStorage\n```\n\n### Normal Operation (Logged Out)\n```\n✓ \"User not authenticated - progress saved to localStorage only\"\n✓ This is expected and good!\n✓ Progress still saves to localStorage\n```\n\n### Error Conditions\n```\n⚠️ \"Failed to save to Supabase (but localStorage was saved)\"\n   → This is OK! localStorage has the data\n\n⚠️ \"Failed to load from Supabase, using localStorage\"\n   → This is OK! Using localStorage data\n\n❌ \"Failed to save progress to localStorage\"\n   → This is BAD! Data not saved\n   → Check browser storage settings\n```\n\n---\n\n## Success Criteria\n\nAll of these should be true:\n\n- ✅ Progress visible immediately after refresh\n- ✅ Progress visible after logout (same device)\n- ✅ Progress visible on different device after login\n- ✅ localStorage key exists and contains data\n- ✅ Supabase user_progress table populated when logged in\n- ✅ App works without internet (offline mode)\n- ✅ No errors in browser console (except expected ones)\n- ✅ Badges, scores, and quiz data all persist\n- ✅ Reset functionality works and persists\n- ✅ Multiple rapid changes all saved\n\n---\n\n## Summary\n\nIf all tests pass, you have:\n\n✅ **Guaranteed persistent storage**\n✅ **Zero data loss on refresh**\n✅ **Zero data loss on logout**\n✅ **Cross-device synchronization**\n✅ **Offline capability**\n✅ **Full backup redundancy**\n\n**All progress is ALWAYS persisted!**\n"